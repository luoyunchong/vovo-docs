(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{599:function(s,e,t){"use strict";t.r(e);var r=t(4),n=Object(r.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"后端准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#后端准备"}},[s._v("#")]),s._v(" 后端准备")]),s._v(" "),t("h2",{attrs:{id:"server-端必备环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#server-端必备环境"}},[s._v("#")]),s._v(" Server 端必备环境")]),s._v(" "),t("ul",[t("li",[s._v("安装软件开发包 "),t("a",{attrs:{href:"https://dotnet.microsoft.com/download/dotnet-core/3.1",target:"_blank",rel:"noopener noreferrer"}},[s._v(".NET Core SDK 3.1"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("安装开发工具  "),t("a",{attrs:{href:"https://visualstudio.microsoft.com/zh-hans/vs/?rr=https%3A%2F%2Fcn.bing.com%2F",target:"_blank",rel:"noopener noreferrer"}},[s._v("Visual Studio 2019"),t("OutboundLink")],1),s._v("  或 "),t("a",{attrs:{href:"https://www.jetbrains.com/rider/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Rider"),t("OutboundLink")],1)]),s._v(" "),t("li",[s._v("安装MySQL（version： 5.6+,别装8.0+，未测试）")]),s._v(" "),t("li",[s._v("Redis 4.0.14.2 for Windows "),t("a",{attrs:{href:"https://github.com/tporadowski/redis/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/tporadowski/redis/releases"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"获取工程项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#获取工程项目"}},[s._v("#")]),s._v(" 获取工程项目")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/luoyunchong/lin-cms-dotnetcore.git\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"数据库配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库配置"}},[s._v("#")]),s._v(" 数据库配置")]),s._v(" "),t("p",[s._v("文件位置src/LinCms.Web/appsettings.Development.json，当数据库中存储表情包是，Charset为utf8mb4")]),s._v(" "),t("p",[t("strong",[s._v("请务必根据自己的实际情况修改此配置项")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ConnectionStrings"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"MySql"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Data Source=localhost;Port=3306;User ID=root;Password=123456;Initial Catalog=lincms;Charset=utf8mb4;SslMode=none;Max pool size=5;"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"CsRedis"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:6379,password=,defaultDatabase=0"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("identityserver4/LinCms.IdentityServer4/appsettings.Development.json 数据库配置")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ConnectionStrings"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"MySql"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Data Source=localhost;Port=3306;User ID=root;Password=123456;Initial Catalog=LinCms;Charset=utf8mb4;SslMode=none;Max pool size=10;"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"数据迁移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据迁移"}},[s._v("#")]),s._v(" 数据迁移")]),s._v(" "),t("p",[s._v("该项目使用"),t("a",{attrs:{href:"https://github.com/2881099/FreeSql",target:"_blank",rel:"noopener noreferrer"}},[s._v("FreeSql"),t("OutboundLink")],1),s._v("，默认自动迁移数据表结构，"),t("strong",[s._v("需要自己创建数据库，名字为LinCms")]),s._v("，无须用户操作，但无数据，而且只有访问到表时才会创建某个表，所以用户可将"),t("a",{attrs:{href:"https://github.com/luoyunchong/lin-cms-dotnetcore/tree/master/docs/sql/%E6%95%B0%E6%8D%AE%E5%BA%93.zip",target:"_blank",rel:"noopener noreferrer"}},[s._v("备份SQL"),t("OutboundLink")],1),s._v("放到Mysql中生成，还原表结构及数据。")]),s._v(" "),t("h2",{attrs:{id:"visual-studio-2019运行项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#visual-studio-2019运行项目"}},[s._v("#")]),s._v(" visual studio 2019运行项目")]),s._v(" "),t("p",[s._v("双击lin-cms-dotnetcore.sln，使用vs2019打开项目。右键解决方案，点击生成解决方案。")]),s._v(" "),t("p",[s._v("由于将identityserver4单独拆成了一个项目，所以需要同时启动二个项目，"),t("strong",[s._v("右键解决方案，属性。")]),s._v(",选择多个启动项目，勾选二个项目同时启动。如下图所示。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://pic.downk.cc/item/5e83fd74504f4bcb04cf5474.png",alt:""}})]),s._v(" "),t("p",[s._v("这时候会打开二个网页  https://localhost:5001/swagger/index.html，即可看到swagger页面。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://pic.downk.cc/item/5e83ffd1504f4bcb04d0f039.jpg",alt:""}})]),s._v(" "),t("p",[s._v("会打开浏览器，访问"),t("a",{attrs:{href:"https://localhosst:5001/swagger/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://localhosst:5001/swagger/index.html"),t("OutboundLink")],1),s._v("，会看到swagger的文档。\n访问"),t("a",{attrs:{href:"https://localhosst:5001/swagger/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://localhosst:5003/swagger/index.html"),t("OutboundLink")],1),s._v(" 是ids4的接口文档，什么也看不到。")]),s._v(" "),t("p",[s._v("LinCms.Web运行效果：\n"),t("img",{attrs:{src:"https://ae01.alicdn.com/kf/He52bc4d3708242d2995419bb584e1f53Q.jpg",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://blog.igeekfan.cn/2019/06/09/dotnetcore/ASP.NET-Core-Deploy-To-Ubuntu",target:"_blank",rel:"noopener noreferrer"}},[s._v("部署至Linux(Ubuntu16.06)"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://blog.igeekfan.cn/2019/06/09/dotnetcore/ASP.NET-Core-Deploy-To-Docker-Ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[s._v("部署至Linux(Ubuntu16.06)下的Docker"),t("OutboundLink")],1)])]),s._v(" "),t("h2",{attrs:{id:"部署前准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署前准备"}},[s._v("#")]),s._v(" 部署前准备")]),s._v(" "),t("p",[s._v("因为该项目基于IdentityServer4,实现的授权认证服务，")]),s._v(" "),t("p",[s._v("开发阶段使用"),t("code",[s._v("AddDeveloperSigningCredential()")]),s._v("方法即可完成签名认证，但是在生产环境，我们必须使用"),t("code",[s._v("AddSigningCredential()")]),s._v("方法并且使用OpenSSL生成自己的签名证书")]),s._v(" "),t("p",[s._v("Startup.cs")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('            services.AddIdentityServer()\n#if  DEBUG\n                .AddDeveloperSigningCredential()\n#endif\n#if !DEBUG\n                .AddSigningCredential(new X509Certificate2(Path.Combine(AppContext.BaseDirectory,\n                        Configuration["Certificates:Path"]),\n                    Configuration["Certificates:Password"]))\n#endif\n                .AddInMemoryIdentityResources(InMemoryConfiguration.GetIdentityResources())\n                .AddInMemoryApiResources(InMemoryConfiguration.GetApis())\n                .AddInMemoryClients(InMemoryConfiguration.GetClients())\n                .AddProfileService<LinCmsProfileService>()\n                .AddResourceOwnerValidator<LinCmsResourceOwnerPasswordValidator>();\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("appsettings.Production.json")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n    "Certificates":\n    {\n        "Path":"ids4.pfx",\n        "Password":"123qwe"\n    }\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"使用openssl生成证书"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用openssl生成证书"}},[s._v("#")]),s._v(" 使用OpenSSL生成证书")]),s._v(" "),t("p",[s._v("官网下载并安装OpenSSL "),t("a",{attrs:{href:"https://slproweb.com/products/Win32OpenSSL.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenSSL官网"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("下载 Win64 OpenSSL v1.1.1b 版本")]),s._v(" "),t("p",[s._v("在OpenSSL的bin文件夹，以管理员身份打开CMD执行以下命令：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("openssl req -newkey rsa:2048 -nodes -keyout ids4.key -x509 -days 365 -out ids4.cer\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("下面将生成的证书和Key封装成一个文件，以便IdentityServer可以使用它们去正确地签名tokens")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("openssl pkcs12 -export -in ids4.cer -inkey ids4.key -out ids4.pfx \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h5",{attrs:{id:"注：在生成的过程中会让我们输入export-password"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注：在生成的过程中会让我们输入export-password"}},[s._v("#")]),s._v(" (注：在生成的过程中会让我们输入Export Password)")]),s._v(" "),t("p",[s._v("这个 密码与appsettings.Production.json配置项相同。")]),s._v(" "),t("p",[s._v("发布时，把ids4.pfx，放到项目根目录")]),s._v(" "),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.cnblogs.com/guolianyu/p/9872661.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("IdentityServer4之JWT签名(RSA加密证书)及验签"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=n.exports}}]);